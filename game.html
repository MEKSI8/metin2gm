<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Okey Oyna - Metin2 Okey Botu | Metin2GM</title>
    <meta name="description" content="Metin2 Okey oyununu sim√ºle edin ve en iyi hamleleri √∂ƒürenin. Yapay zeka destekli okey yardƒ±mcƒ±sƒ±.">
    <meta name="robots" content="noindex, follow"> <!-- Oyun sayfasƒ± i√ßerik olmadƒ±ƒüƒ± i√ßin indexlenmese de olur, ana sayfa √∂nemli -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- ADSENSE KODU -->

    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #0f172a; color: #e2e8f0; touch-action: manipulation; }
        
        .ad-placeholder {
            width: 100%; max-width: 100%; height: 60px;
            background-color: #1e293b; border: 1px dashed #475569;
            display: flex; justify-content: center; align-items: center;
            color: #64748b; font-size: 0.75rem; border-radius: 8px; margin: 0 auto; overflow: hidden;
        }
        @media (min-width: 768px) { .ad-placeholder { height: 90px; } }

        .card {
            width: 100%; aspect-ratio: 2/3; min-width: 0; border-radius: 8px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-weight: 900; font-size: clamp(1rem, 4vw, 1.5rem); cursor: pointer; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4); border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); user-select: none;
            background: linear-gradient(135deg, #334155, #1e293b);
        }
        .card.red { background: linear-gradient(145deg, #ef4444, #991b1b); color: #fee2e2; border-color: #f87171; }
        .card.yellow { background: linear-gradient(145deg, #eab308, #854d0e); color: #fef9c3; border-color: #facc15; }
        .card.blue { background: linear-gradient(145deg, #3b82f6, #1e40af); color: #dbeafe; border-color: #60a5fa; }
        .card:active { transform: scale(0.95); }
        .card.selected-in-modal { transform: translateY(-4px) scale(1.05); box-shadow: 0 0 10px rgba(59, 130, 246, 0.8); border-color: #60a5fa; z-index: 20; }
        .card.selected-in-modal::after { content: '‚úì'; position: absolute; top: -6px; right: -6px; background: #2563eb; color: white; border-radius: 50%; width: 16px; height: 16px; font-size: 10px; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.5); border: 2px solid white; }
        .card.taken { opacity: 0.25; filter: grayscale(100%); cursor: not-allowed; border: 1px dashed #64748b; background: #0f172a; transform: scale(0.95); }
        .suggest-discard { border: 3px solid #ef4444 !important; transform: translateY(-12px); box-shadow: 0 0 20px rgba(239, 68, 68, 0.6); }
        .suggest-keep { border: 3px solid #22c55e !important; transform: translateY(-12px); box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); }
        .opacity-dim { opacity: 0.3; pointer-events: none; filter: grayscale(100%); }
        .hand-grid { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .deck-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 6px; padding: 4px; width: 100%; }
        .hand-grid .card { width: 60px; height: 85px; font-size: 1.5rem; }
        @media (max-width: 640px) { .deck-grid { gap: 4px; } .card.selected-in-modal::after { width: 14px; height: 14px; font-size: 9px; } }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 50; visibility: hidden; opacity: 0; transition: opacity 0.2s; }
        .modal.active { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- √úst Navigasyon -->
    <header class="bg-slate-900 border-b border-slate-700 p-3 sticky top-0 z-30 shadow-xl flex justify-between items-center max-w-3xl mx-auto w-full">
        <a href="index.html" class="flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>
            <span class="text-xs font-bold uppercase tracking-wider">Ana Sayfa</span>
        </a>
        <div class="flex gap-3 text-center">
            <div class="bg-slate-800 px-3 py-1 rounded border border-slate-700">
                <div class="text-[10px] text-slate-400 font-bold">SKOR</div>
                <div class="text-lg font-mono text-white leading-none" id="totalScore">0</div>
            </div>
            <div class="bg-slate-800 px-3 py-1 rounded border border-slate-700">
                <div class="text-[10px] text-slate-400 font-bold">DESTE</div>
                <div class="text-lg font-mono text-blue-400 leading-none" id="deckCount">24</div>
            </div>
        </div>
    </header>

    <!-- [REKLAM ALANI 1] -->
    <div class="w-full px-2 pt-2 flex justify-center">
        <div class="ad-placeholder max-w-3xl">REKLAM ALANI (Oyun √úst√º)</div>
    </div>

    <main class="flex-grow p-4 flex flex-col items-center justify-start gap-6 max-w-3xl mx-auto w-full">
        
        <div id="aiPanel" class="w-full bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700 rounded-2xl p-5 shadow-2xl hidden transform transition-all">
            <div class="flex items-start gap-4">
                <div class="text-4xl" id="aiIcon">ü§ñ</div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold text-white mb-1" id="aiTitle">Analiz...</h2>
                    <p class="text-sm text-slate-300 leading-relaxed" id="aiText">Hesaplanƒ±yor.</p>
                </div>
            </div>
            <button id="executeBtn" class="mt-4 w-full py-4 rounded-xl font-bold text-white shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">HAMLEYƒ∞ UYGULA</button>
        </div>

        <div class="w-full">
            <div class="flex justify-between items-end mb-2 px-2">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest">Mevcut Eliniz</h3>
                <span class="text-xs text-green-500 font-mono hidden" id="handValueIndicator">Potansiyel: Y√ºksek</span>
            </div>
            <div class="bg-slate-800/50 border border-slate-700/50 rounded-2xl p-6 min-h-[140px] flex justify-center items-center relative shadow-inner">
                <div class="hand-grid w-full justify-center" id="myHand">
                    <button onclick="startHandSelection()" class="px-8 py-4 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-bold shadow-lg shadow-blue-500/20 animate-pulse transition-all">
                        ‚úã Oyuna Ba≈üla
                    </button>
                </div>
            </div>
        </div>

        <!-- [REKLAM ALANI 2] -->
        <div class="w-full"><div class="ad-placeholder">REKLAM ALANI (Oyun Altƒ±)</div></div>

        <button onclick="if(confirm('Sƒ±fƒ±rlamak istediƒüinize emin misiniz?')) window.location.reload()" class="text-xs text-slate-600 hover:text-slate-400 uppercase tracking-widest mt-auto mb-4 p-2">[ Sƒ∞STEMƒ∞ SIFIRLA ]</button>
    </main>

    <!-- Modallar (Aynƒ±) -->
    <div id="cardPickerModal" class="modal backdrop-blur-md">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl p-5 w-full max-w-lg m-4 shadow-2xl flex flex-col max-h-[90vh]">
            <div class="text-center mb-4"><h3 class="text-xl text-white font-bold" id="modalTitle">Kart Se√ßimi</h3><p class="text-sm text-slate-400" id="modalSubtext">Se√ßim yapƒ±n.</p></div>
            <div class="overflow-y-auto p-2 flex-grow"><div class="deck-grid" id="pickerGrid"></div></div>
            <div class="mt-4 pt-4 border-t border-slate-800"><button id="modalConfirmBtn" class="w-full py-3 bg-slate-700 text-slate-400 rounded-xl font-bold cursor-not-allowed transition-all" disabled>Se√ßimi Tamamla (0/0)</button></div>
        </div>
    </div>
    <div id="resultModal" class="modal">
        <div class="bg-slate-900 border-2 border-yellow-500/30 rounded-2xl p-8 max-w-sm w-full text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-yellow-500/10 to-transparent"></div>
            <div class="relative z-10"><div class="text-6xl mb-4 animate-bounce">üèÜ</div><h2 class="text-3xl font-black text-white mb-2 tracking-tight">OYUN Bƒ∞TTƒ∞</h2><div class="text-sm text-slate-400 mb-6">TOPLAM SKOR</div><div class="text-6xl font-mono font-bold text-yellow-400 mb-8" id="finalScore">0</div><div id="rewardText" class="text-xl font-bold mb-8 py-2 px-6 rounded-lg bg-white/10 inline-block border border-white/10"></div><button onclick="window.location.reload()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-white shadow-lg transition-all">YENƒ∞ OYUN</button></div>
        </div>
    </div>

<script>
// --- PARAMETRELER (TRADER AI) ---
const AI_PARAMS = { RISK_BIAS_SILVER: 46, RISK_BIAS_NORMAL: 26, THRESHOLD_BASE: 40, THRESHOLD_LOW: 0, ALWAYS_TAKE_SCORE: 30, PANIC_TRIGGER: 12, EARLY_GAME_LIMIT: 8, DISCARD_AGRESSION: 131, DISCARD_COST: 37, PAIR_WEIGHT: 7, SERIES_WEIGHT: 21, GAP_WEIGHT: 10 };
const COLORS = { r: 'red', y: 'yellow', b: 'blue' };
const EMOJIS = { r: '‚ù§Ô∏è', y: 'üíõ', b: 'üíô' };
let FULL_DECK = []; ['r','y','b'].forEach(c=>{for(let i=1;i<=8;i++)FULL_DECK.push({id:c+i,color:c,val:i})});
let state = { hand: [], deckRemaining: [...FULL_DECK], totalScore: 0, suggestion: null, tempSelection: [] };

function evaluateHandScore(cards) {
    if(cards.length!==3) return 0;
    const s = [...cards].sort((a,b)=>a.val-b.val);
    const [c1,c2,c3] = s;
    if(c1.val===c2.val && c2.val===c3.val) return (c1.val-1)*10+20;
    if(!((c1.val+1===c2.val)&&(c2.val+1===c3.val))) return 0;
    if(c1.color===c2.color && c2.color===c3.color) return (c1.val-1)*10+50;
    return (c1.val-1)*10+10;
}
function getBestSet(hand) {
    let best = {s:0, c:[]};
    for(let i=0;i<hand.length;i++) for(let j=i+1;j<hand.length;j++) for(let k=j+1;k<hand.length;k++) {
        const sub = [hand[i],hand[j],hand[k]]; const sc = evaluateHandScore(sub); if(sc>best.s) best = {s:sc,c:sub};
    } return best;
}
function calculateHandPotential(hand) {
    let pot = 0;
    for(let i=0;i<hand.length;i++) for(let j=i+1;j<hand.length;j++) {
        const c1=hand[i], c2=hand[j];
        if(c1.val===c2.val) pot+=AI_PARAMS.PAIR_WEIGHT;
        else if(c1.color===c2.color) { const d=Math.abs(c1.val-c2.val); if(d===1) pot+=AI_PARAMS.SERIES_WEIGHT; else if(d===2) pot+=AI_PARAMS.GAP_WEIGHT; }
    } return pot;
}
function analyzeMove() {
    const hand=state.hand, deck=state.deckRemaining, bestSet=getBestSet(hand);
    let threshold=AI_PARAMS.THRESHOLD_BASE;
    if(state.totalScore>=400) threshold=0;
    else if(deck.length>AI_PARAMS.EARLY_GAME_LIMIT) threshold=AI_PARAMS.THRESHOLD_BASE;
    else if(state.totalScore<300) { threshold=AI_PARAMS.THRESHOLD_LOW; if(deck.length<=AI_PARAMS.PANIC_TRIGGER) threshold=0; }
    else if(deck.length<5) threshold=0;

    let shouldCombine=false;
    if(bestSet.s>0) { if(bestSet.s>=threshold) shouldCombine=true; else if(deck.length<=3) shouldCombine=true; else if(bestSet.s>=AI_PARAMS.ALWAYS_TAKE_SCORE) shouldCombine=true; }

    let bestDiscardIdx=0, maxTotalVal=-Infinity;
    const sampleSize=Math.min(10, deck.length);
    const samples=deck.length>0 ? Array.from({length:sampleSize},()=>deck[Math.floor(Math.random()*deck.length)]) : [];

    for(let i=0;i<hand.length;i++) {
        const tempHand=hand.filter((_,idx)=>idx!==i);
        let mcEV=0;
        if(samples.length===0) mcEV=getBestSet(tempHand).s;
        else { let total=0; for(let c of samples) total+=getBestSet([...tempHand,c]).s; mcEV=total/sampleSize; }
        const pot=calculateHandPotential(tempHand);
        const totalVal=(mcEV*(AI_PARAMS.DISCARD_AGRESSION/100.0))+pot-AI_PARAMS.DISCARD_COST;
        if(totalVal>maxTotalVal) { maxTotalVal=totalVal; bestDiscardIdx=i; }
    }
    const bias=(state.totalScore<300) ? AI_PARAMS.RISK_BIAS_SILVER : AI_PARAMS.RISK_BIAS_NORMAL;
    if(!shouldCombine && bestSet.s>0) if((maxTotalVal-bestSet.s)<bias) shouldCombine=true;
    return shouldCombine ? {type:'COMBINE', score:bestSet.s, cards:bestSet.c} : {type:'DISCARD', score:0, cards:[hand[bestDiscardIdx]]};
}
function updateUI(move) {
    const p=document.getElementById('aiPanel'), t=document.getElementById('aiTitle'), txt=document.getElementById('aiText'), btn=document.getElementById('executeBtn'), ico=document.getElementById('aiIcon');
    p.classList.remove('hidden'); state.suggestion=move;
    if(move.type==='COMBINE') {
        ico.innerText="üí∞"; t.innerText=`SET FIRSATI (${move.score} PUAN)`; t.className="text-xl font-bold text-green-400 mb-1";
        txt.innerText="Risk almaya gerek yok. Bu puanƒ± kasaya atalƒ±m.";
        btn.className="mt-4 w-full py-4 bg-green-600 hover:bg-green-500 rounded-xl font-bold text-white shadow-lg flex items-center justify-center gap-2"; btn.innerText="Bƒ∞RLE≈ûTƒ∞R VE DEVAM ET";
    } else {
        const c=move.cards[0]; ico.innerText="üóëÔ∏è"; t.innerText=`KARTI AT: ${c.val} ${EMOJIS[c.color]}`; t.className="text-xl font-bold text-red-400 mb-1";
        txt.innerText="Bu kart ≈üu an i≈üe yaramƒ±yor. Daha iyisi i√ßin deƒüi≈ütirelim.";
        btn.className="mt-4 w-full py-4 bg-red-600 hover:bg-red-500 rounded-xl font-bold text-white shadow-lg flex items-center justify-center gap-2"; btn.innerText="KARTI AT";
    } renderHand();
}
function renderHand() {
    const div=document.getElementById('myHand'); div.innerHTML='';
    state.hand.forEach(c=>{
        const el=document.createElement('div'); el.className=`card ${COLORS[c.color]}`; el.innerHTML=`${c.val} <span class="text-xs absolute top-1 right-1 opacity-50">${EMOJIS[c.color]}</span>`;
        if(state.suggestion) {
            const isTarget=state.suggestion.cards.some(x=>x.id===c.id);
            if(isTarget) state.suggestion.type==='COMBINE' ? el.classList.add('suggest-keep') : el.classList.add('suggest-discard');
            else if(state.suggestion.type==='COMBINE') el.classList.add('opacity-dim');
        } div.appendChild(el);
    });
    document.getElementById('totalScore').innerText=state.totalScore; document.getElementById('deckCount').innerText=state.deckRemaining.length;
}
function renderPicker(cnt, cb) {
    const m=document.getElementById('cardPickerModal'), g=document.getElementById('pickerGrid'), t=document.getElementById('modalTitle'), b=document.getElementById('modalConfirmBtn');
    g.innerHTML=''; state.tempSelection=[]; t.innerText=`${cnt} Kart Se√ßiniz`; updateConfirmButton(cnt);
    FULL_DECK.forEach(c=>{
        const isAv=state.deckRemaining.some(r=>r.id===c.id); const el=document.createElement('div'); el.className=`card ${COLORS[c.color]}`; el.innerHTML=`${c.val} <span class="text-xs absolute top-1 right-1 opacity-50">${EMOJIS[c.color]}</span>`;
        if(!isAv) el.classList.add('taken');
        else el.onclick=()=>{
            if(state.tempSelection.includes(c)) { state.tempSelection=state.tempSelection.filter(x=>x!==c); el.classList.remove('selected-in-modal'); }
            else if(state.tempSelection.length<cnt) { state.tempSelection.push(c); el.classList.add('selected-in-modal'); }
            updateConfirmButton(cnt);
        }; g.appendChild(el);
    });
    b.onclick=()=>{ if(state.tempSelection.length===cnt) { m.classList.remove('active'); cb(state.tempSelection); } }; m.classList.add('active');
}
function updateConfirmButton(cnt) {
    const b=document.getElementById('modalConfirmBtn'), curr=state.tempSelection.length; b.innerText=`Se√ßimi Tamamla (${curr}/${cnt})`;
    if(curr===cnt) { b.classList.replace('bg-slate-700','bg-blue-600'); b.classList.replace('text-slate-400','text-white'); b.disabled=false; }
    else { b.classList.replace('bg-blue-600','bg-slate-700'); b.classList.replace('text-white','text-slate-400'); b.disabled=true; }
}
function startHandSelection() { renderPicker(5, (c)=>{ state.hand=c; state.deckRemaining=state.deckRemaining.filter(x=>!c.includes(x)); document.getElementById('myHand').innerHTML=''; updateUI(analyzeMove()); }); }
document.getElementById('executeBtn').onclick=()=>{
    const m=state.suggestion; if(!m) return;
    if(m.type==='COMBINE') { state.totalScore+=m.score; const ids=m.cards.map(x=>x.id); state.hand=state.hand.filter(x=>!ids.includes(x.id));
        const need=Math.min(3,state.deckRemaining.length); if(need>0) renderPicker(need,(nc)=>{ state.hand.push(...nc); state.deckRemaining=state.deckRemaining.filter(x=>!nc.includes(x)); updateUI(analyzeMove()); }); else endGame();
    } else { const rm=m.cards[0]; state.hand=state.hand.filter(x=>x.id!==rm.id);
        if(state.deckRemaining.length>0) renderPicker(1,(nc)=>{ state.hand.push(...nc); state.deckRemaining=state.deckRemaining.filter(x=>!nc.includes(x)); updateUI(analyzeMove()); }); else endGame();
    }
}
function endGame() {
    document.getElementById('resultModal').classList.add('active'); document.getElementById('finalScore').innerText=state.totalScore;
    let t="BRONZ SANDIK üì¶", s="text-orange-400 border-orange-500";
    if(state.totalScore>=400) { t="ALTIN SANDIK ‚ú®"; s="text-yellow-400 border-yellow-500"; }
    else if(state.totalScore>=300) { t="G√úM√ú≈û SANDIK ‚õìÔ∏è"; s="text-slate-300 border-slate-400"; }
    const r=document.getElementById('rewardText'); r.innerText=t; r.className=`text-xl font-bold mb-8 py-2 px-6 rounded-lg bg-white/10 inline-block border ${s}`;
}
</script>
</body>

</html>
