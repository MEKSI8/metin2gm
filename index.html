<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Yapay Zeka destekli Okey analiz ve taktik aracƒ±. En iyi hamleleri √∂ƒürenin, kazanma ≈üansƒ±nƒ±zƒ± artƒ±rƒ±n.">
    <title>Okey Ustasƒ± - Pro Trader AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- 
      === ADSENSE REKLAM KODU BURAYA ===
      Google AdSense onay aldƒ±ƒüƒ±nda size vereceƒüi kodu buraya yapƒ±≈ütƒ±racaksƒ±nƒ±z.
      √ñrnek: <script async src="https://pagead2.googlesyndication.com/..."></script>
    -->

    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #0f172a; color: #e2e8f0; touch-action: manipulation; }
        
        /* Reklam Alanƒ± Stili (Yer Tutucu) */
        .ad-placeholder {
            width: 100%;
            max-width: 100%;
            height: 60px; /* Mobilde k√º√ß√ºk */
            background-color: #1e293b;
            border: 1px dashed #475569;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #64748b;
            font-size: 0.75rem;
            border-radius: 8px;
            margin: 0 auto;
            overflow: hidden;
        }
        @media (min-width: 768px) {
            .ad-placeholder { height: 90px; } /* Masa√ºst√ºnde b√ºy√ºk banner */
        }

        /* Kart Tasarƒ±mƒ± (Esnek Boyutlandƒ±rma) */
        .card {
            width: 100%; /* Kapsayƒ±cƒ±ya g√∂re geni≈üle */
            aspect-ratio: 2/3; /* En-boy oranƒ±nƒ± koru */
            min-width: 0; /* Flex/Grid ta≈ümasƒ±nƒ± √∂nle */
            border-radius: 8px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-weight: 900; font-size: clamp(1rem, 4vw, 1.5rem); /* Fontu ekrana g√∂re ayarla */
            cursor: pointer; position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            background: linear-gradient(135deg, #334155, #1e293b); /* Default Back */
        }
        
        .card.red { background: linear-gradient(145deg, #ef4444, #991b1b); color: #fee2e2; border-color: #f87171; }
        .card.yellow { background: linear-gradient(145deg, #eab308, #854d0e); color: #fef9c3; border-color: #facc15; }
        .card.blue { background: linear-gradient(145deg, #3b82f6, #1e40af); color: #dbeafe; border-color: #60a5fa; }

        .card:active { transform: scale(0.95); }
        
        /* Geli≈ümi≈ü Se√ßim Efektleri */
        .card.selected-in-modal {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8); /* Mavi parlama */
            border-color: #60a5fa;
            z-index: 20;
        }
        /* Se√ßim tiki */
        .card.selected-in-modal::after {
            content: '‚úì';
            position: absolute;
            top: -6px; right: -6px;
            background: #2563eb;
            color: white;
            border-radius: 50%;
            width: 16px; height: 16px;
            font-size: 10px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            border: 2px solid white;
        }

        /* Pasif (Alƒ±nmƒ±≈ü) Kart Efekti */
        .card.taken {
            opacity: 0.25;
            filter: grayscale(100%);
            cursor: not-allowed;
            border: 1px dashed #64748b;
            background: #0f172a;
            transform: scale(0.95);
        }
        
        /* AI √ñnerileri */
        .suggest-discard { border: 3px solid #ef4444 !important; transform: translateY(-12px); box-shadow: 0 0 20px rgba(239, 68, 68, 0.6); }
        .suggest-keep { border: 3px solid #22c55e !important; transform: translateY(-12px); box-shadow: 0 0 20px rgba(34, 197, 94, 0.6); }
        .opacity-dim { opacity: 0.3; pointer-events: none; filter: grayscale(100%); }

        /* Gridler */
        .hand-grid { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        
        /* Deste Izgarasƒ± - Her zaman 8 s√ºtun */
        .deck-grid { 
            display: grid; 
            grid-template-columns: repeat(8, 1fr); 
            gap: 6px; 
            padding: 4px;
            width: 100%;
        }
        
        /* Eldeki kartlar i√ßin sabit boyut (Daha ≈üƒ±k g√∂r√ºnmesi i√ßin) */
        .hand-grid .card {
            width: 60px;
            height: 85px;
            font-size: 1.5rem;
        }

        /* Mobilde Deste Izgarasƒ± ƒ∞nce Ayar */
        @media (max-width: 640px) { 
            .deck-grid { gap: 4px; } 
            .card.selected-in-modal::after { width: 14px; height: 14px; font-size: 9px; }
        }

        /* Modal */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; justify-content: center; align-items: center; z-index: 50; visibility: hidden; opacity: 0; transition: opacity 0.2s; }
        .modal.active { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- √úst Bilgi √áubuƒüu -->
    <header class="bg-slate-900 border-b border-slate-700 p-3 sticky top-0 z-30 shadow-xl">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-400 tracking-tight">OKEY<span class="text-white">USTASI</span></h1>
                <p class="text-[10px] text-slate-500 font-mono tracking-widest">TRADER AI v2.0</p>
            </div>
            <div class="flex gap-3 text-center">
                <div class="bg-slate-800 px-3 py-1 rounded border border-slate-700">
                    <div class="text-[10px] text-slate-400 font-bold">SKOR</div>
                    <div class="text-lg font-mono text-white leading-none" id="totalScore">0</div>
                </div>
                <div class="bg-slate-800 px-3 py-1 rounded border border-slate-700">
                    <div class="text-[10px] text-slate-400 font-bold">DESTE</div>
                    <div class="text-lg font-mono text-blue-400 leading-none" id="deckCount">24</div>
                </div>
            </div>
        </div>
    </header>

    <!-- [REKLAM ALANI 1] - √úst Banner -->
    <div class="w-full px-2 pt-2 flex justify-center">
        <div class="ad-placeholder max-w-3xl">
            <span>REKLAM ALANI (√úst Banner)</span>
            <!-- Google AdSense Kodu Buraya Gelecek -->
        </div>
    </div>

    <main class="flex-grow p-4 flex flex-col items-center justify-start gap-6 max-w-3xl mx-auto w-full">
        
        <!-- Yapay Zeka Paneli -->
        <div id="aiPanel" class="w-full bg-gradient-to-br from-slate-900 to-slate-800 border border-slate-700 rounded-2xl p-5 shadow-2xl hidden transform transition-all">
            <div class="flex items-start gap-4">
                <div class="text-4xl" id="aiIcon">ü§ñ</div>
                <div class="flex-1">
                    <h2 class="text-xl font-bold text-white mb-1" id="aiTitle">Analiz Yapƒ±lƒ±yor...</h2>
                    <p class="text-sm text-slate-300 leading-relaxed" id="aiText">L√ºtfen bekleyin.</p>
                </div>
            </div>
            
            <!-- Aksiyon Butonu -->
            <button id="executeBtn" class="mt-4 w-full py-4 rounded-xl font-bold text-white shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2">
                <span>HAMLEYƒ∞ UYGULA</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
            </button>
        </div>

        <!-- Kullanƒ±cƒ±nƒ±n Eli -->
        <div class="w-full">
            <div class="flex justify-between items-end mb-2 px-2">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest">Mevcut Eliniz</h3>
                <span class="text-xs text-green-500 font-mono hidden" id="handValueIndicator">Potansiyel: Y√ºksek</span>
            </div>
            <div class="bg-slate-800/50 border border-slate-700/50 rounded-2xl p-6 min-h-[140px] flex justify-center items-center relative shadow-inner">
                <div class="hand-grid w-full justify-center" id="myHand">
                    <button onclick="startHandSelection()" class="px-8 py-4 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-bold shadow-lg shadow-blue-500/20 animate-pulse transition-all">
                        ‚úã Oyuna Ba≈üla (5 Kart Se√ß)
                    </button>
                </div>
            </div>
        </div>

        <!-- [REKLAM ALANI 2] - Oyun ƒ∞√ßi Banner -->
        <div class="w-full">
            <div class="ad-placeholder">
                <span>REKLAM ALANI (Oyun ƒ∞√ßi)</span>
                <!-- Google AdSense Kodu Buraya Gelecek -->
            </div>
        </div>

        <button onclick="if(confirm('Oyunu sƒ±fƒ±rlamak istiyor musunuz?')) window.location.reload()" class="text-xs text-slate-600 hover:text-slate-400 uppercase tracking-widest mt-auto mb-4 p-2">
            [ Sƒ∞STEMƒ∞ SIFIRLA ]
        </button>

    </main>

    <!-- Kart Se√ßim Modalƒ± -->
    <div id="cardPickerModal" class="modal backdrop-blur-md">
        <div class="bg-slate-900 border border-slate-700 rounded-2xl p-5 w-full max-w-lg m-4 shadow-2xl flex flex-col max-h-[90vh]">
            <div class="text-center mb-4">
                <h3 class="text-xl text-white font-bold" id="modalTitle">Kart Se√ßimi</h3>
                <p class="text-sm text-slate-400" id="modalSubtext">Desteden √ßektiƒüiniz kartlarƒ± i≈üaretleyin. (Soluk kartlar bitmi≈ütir)</p>
            </div>
            
            <div class="overflow-y-auto p-2 flex-grow">
                <!-- Grid Container -->
                <div class="deck-grid" id="pickerGrid">
                    <!-- Kartlar buraya JS ile dolacak -->
                </div>
            </div>

            <div class="mt-4 pt-4 border-t border-slate-800">
                <button id="modalConfirmBtn" class="w-full py-3 bg-slate-700 text-slate-400 rounded-xl font-bold cursor-not-allowed transition-all" disabled>
                    Se√ßimi Tamamla (0/0)
                </button>
            </div>
        </div>
    </div>

    <!-- Sonu√ß Modalƒ± -->
    <div id="resultModal" class="modal">
        <div class="bg-slate-900 border-2 border-yellow-500/30 rounded-2xl p-8 max-w-sm w-full text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-yellow-500/10 to-transparent"></div>
            <div class="relative z-10">
                <div class="text-6xl mb-4 animate-bounce">üèÜ</div>
                <h2 class="text-3xl font-black text-white mb-2 tracking-tight">OYUN Bƒ∞TTƒ∞</h2>
                <div class="text-sm text-slate-400 mb-6">TOPLAM SKOR</div>
                <div class="text-6xl font-mono font-bold text-yellow-400 mb-8" id="finalScore">0</div>
                <div id="rewardText" class="text-xl font-bold mb-8 py-2 px-6 rounded-lg bg-white/10 inline-block border border-white/10"></div>
                <button onclick="window.location.reload()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold text-white shadow-lg transition-all">
                    YENƒ∞ OYUN
                </button>
            </div>
        </div>
    </div>

<script>
/**
 * OKEY USTASI - TRADER EDITION (V2.0)
 * Bu algoritma, yapƒ±lan eƒüitimler sonucu "G√ºm√º≈ü Garantili, Altƒ±n Fƒ±rsat√ßƒ±" 
 * stratejisine g√∂re optimize edilmi≈ü parametreleri kullanƒ±r.
 */

// --- EN ƒ∞Yƒ∞ Eƒûƒ∞Tƒ∞LMƒ∞≈û PARAMETRELER ---
const AI_PARAMS = {
    RISK_BIAS_SILVER: 80,    // G√ºm√º≈ü altƒ±ndayken a≈üƒ±rƒ± korumacƒ±
    RISK_BIAS_NORMAL: 25,    // G√ºm√º≈ü sonrasƒ± kontroll√º risk
    THRESHOLD_BASE: 45,      // ƒ∞deal set puanƒ±
    THRESHOLD_LOW: 20,       // Panik/G√ºm√º≈ü kurtarma puanƒ±
    ALWAYS_TAKE_SCORE: 35,   // Sorgusuz sualsiz alƒ±nacak puan (Fƒ±rsat)
    PANIC_TRIGGER: 10,       // 10 kart kalƒ±nca panikle
    EARLY_GAME_LIMIT: 16,    // ƒ∞lk 3 kartta (19->16) sakin kal
    DISCARD_AGRESSION: 90,   // Geleceƒüe %90 g√ºven (Biraz k√∂t√ºmser)
    DISCARD_COST: 35,        // Kart atmanƒ±n maliyeti (Pahalƒ±)
    PAIR_WEIGHT: 15,         // √áift deƒüeri
    SERIES_WEIGHT: 40,       // Sƒ±ralƒ± deƒüeri
    GAP_WEIGHT: 15           // Bo≈üluklu deƒüeri
};

const COLORS = { r: 'red', y: 'yellow', b: 'blue' };
const EMOJIS = { r: '‚ù§Ô∏è', y: 'üíõ', b: 'üíô' };

// Deste Olu≈üturma
let FULL_DECK = [];
['r', 'y', 'b'].forEach(c => {
    for (let i = 1; i <= 8; i++) {
        FULL_DECK.push({ id: c + i, color: c, val: i });
    }
});

let state = {
    hand: [],
    deckRemaining: [...FULL_DECK], // Kopyasƒ±
    totalScore: 0,
    suggestion: null,
    tempSelection: [] // Modal se√ßimleri i√ßin ge√ßici hafƒ±za
};

// --- OYUN MOTORU (CORE LOGIC) ---

function evaluateHandScore(cards) {
    if (cards.length !== 3) return 0;
    const s = [...cards].sort((a, b) => a.val - b.val);
    const [c1, c2, c3] = s;

    // 1. Aynƒ± Sayƒ± (20-90)
    if (c1.val === c2.val && c2.val === c3.val) return (c1.val - 1) * 10 + 20;
    
    // Sƒ±ralƒ± Deƒüilse √áƒ±k
    if (!((c1.val + 1 === c2.val) && (c2.val + 1 === c3.val))) return 0;

    // 2. Renkli Sƒ±ra (50-120)
    if (c1.color === c2.color && c2.color === c3.color) return (c1.val - 1) * 10 + 50;
    
    // 3. Karƒ±≈üƒ±k Sƒ±ra (10-80)
    return (c1.val - 1) * 10 + 10;
}

function getBestSet(hand) {
    let best = { s: 0, c: [] };
    for (let i = 0; i < hand.length; i++)
        for (let j = i + 1; j < hand.length; j++)
            for (let k = j + 1; k < hand.length; k++) {
                const sub = [hand[i], hand[j], hand[k]];
                const sc = evaluateHandScore(sub);
                if (sc > best.s) best = { s: sc, c: sub };
            }
    return best;
}

function calculateHandPotential(hand) {
    let pot = 0;
    for (let i = 0; i < hand.length; i++) {
        for (let j = i + 1; j < hand.length; j++) {
            const c1 = hand[i], c2 = hand[j];
            if (c1.val === c2.val) pot += AI_PARAMS.PAIR_WEIGHT;
            else if (c1.color === c2.color) {
                const diff = Math.abs(c1.val - c2.val);
                if (diff === 1) pot += AI_PARAMS.SERIES_WEIGHT;
                else if (diff === 2) pot += AI_PARAMS.GAP_WEIGHT;
            }
        }
    }
    return pot;
}

function analyzeMove() {
    const hand = state.hand;
    const deck = state.deckRemaining;
    const bestSet = getBestSet(hand);
    
    // E≈ûƒ∞K MANTIƒûI
    let threshold = AI_PARAMS.THRESHOLD_BASE;
    
    if (state.totalScore >= 400) {
        threshold = 0; // Altƒ±n cepte, ne varsa al
    } else if (deck.length > AI_PARAMS.EARLY_GAME_LIMIT) {
        threshold = AI_PARAMS.THRESHOLD_BASE; // Erken oyun, se√ßici ol
    } else if (state.totalScore < 300) {
        threshold = AI_PARAMS.THRESHOLD_LOW; // G√ºm√º≈ü tehlikede, d√º≈ü√ºr
        if (deck.length <= AI_PARAMS.PANIC_TRIGGER) threshold = 0; // Panik!
    } else {
        // G√ºm√º≈ü garanti, Altƒ±n hedefliyoruz
        if (deck.length < 5) threshold = 0; // Son d√ºzl√ºk
    }

    // SET ALMA KARARI
    let shouldCombine = false;
    if (bestSet.s > 0) {
        if (bestSet.s >= threshold) shouldCombine = true;
        else if (deck.length <= 3) shouldCombine = true;
        else if (bestSet.s >= AI_PARAMS.ALWAYS_TAKE_SCORE) shouldCombine = true;
    }

    // DISCARD ANALƒ∞Zƒ∞ (EXPECTIMAX LITE)
    let bestDiscardIdx = 0;
    let maxTotalVal = -Infinity;
    
    // Tarayƒ±cƒ± performansƒ±nƒ± korumak i√ßin 10 √∂rneklem yeterli
    const sampleSize = Math.min(10, deck.length);
    const samples = deck.length > 0 ? Array.from({length: sampleSize}, () => deck[Math.floor(Math.random()*deck.length)]) : [];

    for(let i=0; i<hand.length; i++) {
        const tempHand = hand.filter((_, idx) => idx !== i);
        
        let mcEV = 0;
        if(samples.length === 0) {
            mcEV = getBestSet(tempHand).s;
        } else {
            let total = 0;
            for(let card of samples) total += getBestSet([...tempHand, card]).s;
            mcEV = total / sampleSize;
        }

        const pot = calculateHandPotential(tempHand);
        // Form√ºl: (Gelecek * Agresiflik) + Potansiyel - Maliyet
        const totalVal = (mcEV * (AI_PARAMS.DISCARD_AGRESSION / 100.0)) + pot - AI_PARAMS.DISCARD_COST;

        if(totalVal > maxTotalVal) {
            maxTotalVal = totalVal;
            bestDiscardIdx = i;
        }
    }

    // Rƒ∞SK KARARI
    const bias = (state.totalScore < 300) ? AI_PARAMS.RISK_BIAS_SILVER : AI_PARAMS.RISK_BIAS_NORMAL;
    
    if(!shouldCombine && bestSet.s > 0) {
        // (Gelecek - Mevcut) < Risk => Riske girme, al.
        if((maxTotalVal - bestSet.s) < bias) {
            shouldCombine = true;
        }
    }

    return shouldCombine 
        ? { type: 'COMBINE', score: bestSet.s, cards: bestSet.c }
        : { type: 'DISCARD', score: 0, cards: [hand[bestDiscardIdx]] };
}

// --- UI ƒ∞≈ûLEVLERƒ∞ ---

function updateUI(move) {
    const aiPanel = document.getElementById('aiPanel');
    const title = document.getElementById('aiTitle');
    const text = document.getElementById('aiText');
    const btn = document.getElementById('executeBtn');
    const icon = document.getElementById('aiIcon');
    
    aiPanel.classList.remove('hidden');
    state.suggestion = move;

    if(move.type === 'COMBINE') {
        icon.innerText = "üí∞";
        title.innerText = `SET FIRSATI (${move.score} PUAN)`;
        title.className = "text-xl font-bold text-green-400 mb-1";
        text.innerText = "Risk almaya gerek yok. Bu puanƒ± kasaya atalƒ±m.";
        
        btn.className = "mt-4 w-full py-4 bg-green-600 hover:bg-green-500 rounded-xl font-bold text-white shadow-lg transition-all flex items-center justify-center gap-2";
        btn.innerHTML = `<span>Bƒ∞RLE≈ûTƒ∞R VE DEVAM ET</span>`;
    } else {
        const c = move.cards[0];
        icon.innerText = "üóëÔ∏è";
        title.innerText = `KARTI AT: ${c.val} ${EMOJIS[c.color]}`;
        title.className = "text-xl font-bold text-red-400 mb-1";
        text.innerText = "Bu kart ≈üu an i≈üe yaramƒ±yor. Daha iyisi i√ßin deƒüi≈ütirelim.";
        
        btn.className = "mt-4 w-full py-4 bg-red-600 hover:bg-red-500 rounded-xl font-bold text-white shadow-lg transition-all flex items-center justify-center gap-2";
        btn.innerHTML = `<span>KARTI AT</span>`;
    }
    renderHand();
}

function renderHand() {
    const div = document.getElementById('myHand');
    div.innerHTML = '';
    
    state.hand.forEach(c => {
        const el = document.createElement('div');
        el.className = `card ${COLORS[c.color]}`; // CSS class mapping
        el.innerHTML = `${c.val} <span class="text-xs absolute top-1 right-1 opacity-50">${EMOJIS[c.color]}</span>`;
        
        if(state.suggestion) {
            const isTarget = state.suggestion.cards.some(x => x.id === c.id);
            if(isTarget) {
                if(state.suggestion.type === 'COMBINE') el.classList.add('suggest-keep');
                else el.classList.add('suggest-discard');
            } else if(state.suggestion.type === 'COMBINE') {
                el.classList.add('opacity-dim');
            }
        }
        div.appendChild(el);
    });
    
    document.getElementById('totalScore').innerText = state.totalScore;
    document.getElementById('deckCount').innerText = state.deckRemaining.length;
}

// --- AKILLI SE√áƒ∞M MODALI ---
function renderPicker(targetCount, callback) {
    const modal = document.getElementById('cardPickerModal');
    const grid = document.getElementById('pickerGrid');
    const title = document.getElementById('modalTitle');
    const sub = document.getElementById('modalSubtext');
    const confirmBtn = document.getElementById('modalConfirmBtn');
    
    grid.innerHTML = '';
    state.tempSelection = []; 
    
    title.innerText = `${targetCount} Kart Se√ßiniz`;
    
    // FULL_DECK √ºzerinde d√∂n, hepsini g√∂ster
    FULL_DECK.forEach(c => {
        // Kartƒ±n uygunluk durumunu kontrol et
        // (Destedeyse aktiftir, deƒüilse pasiftir)
        const isAvailable = state.deckRemaining.some(r => r.id === c.id);
        
        const el = document.createElement('div');
        el.className = `card ${COLORS[c.color]}`;
        el.innerHTML = `${c.val} <span class="text-xs absolute top-1 right-1 opacity-50">${EMOJIS[c.color]}</span>`;
        
        if (!isAvailable) {
            el.classList.add('taken'); // Pasif stil
        } else {
            // Sadece uygun kartlara tƒ±klama √∂zelliƒüi ekle
            el.onclick = () => {
                if (state.tempSelection.includes(c)) {
                    // Varsa √ßƒ±kar (Toggle Off)
                    state.tempSelection = state.tempSelection.filter(x => x !== c);
                    el.classList.remove('selected-in-modal');
                } else {
                    // Yoksa ekle (Toggle On) - Limit kontrol√ºyle
                    if (state.tempSelection.length < targetCount) {
                        state.tempSelection.push(c);
                        el.classList.add('selected-in-modal');
                    }
                }
                updateConfirmButton(targetCount);
            }
        }
        grid.appendChild(el);
    });
    
    updateConfirmButton(targetCount);
    
    confirmBtn.onclick = () => {
        if (state.tempSelection.length === targetCount) {
            modal.classList.remove('active');
            callback(state.tempSelection);
        }
    };
    
    modal.classList.add('active');
}

function updateConfirmButton(targetCount) {
    const btn = document.getElementById('modalConfirmBtn');
    const current = state.tempSelection.length;
    btn.innerText = `Se√ßimi Tamamla (${current}/${targetCount})`;
    
    if (current === targetCount) {
        btn.classList.remove('bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
        btn.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-500');
        btn.disabled = false;
    } else {
        btn.classList.add('bg-slate-700', 'text-slate-400', 'cursor-not-allowed');
        btn.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-500');
        btn.disabled = true;
    }
}

// --- OYUN AKI≈ûI ---

function startHandSelection() {
    renderPicker(5, (selectedCards) => {
        state.hand = selectedCards;
        state.deckRemaining = state.deckRemaining.filter(c => !selectedCards.includes(c));
        document.getElementById('myHand').innerHTML = ''; // Butonu temizle
        updateUI(analyzeMove());
    });
}

document.getElementById('executeBtn').onclick = () => {
    const move = state.suggestion;
    if(!move) return;

    if(move.type === 'COMBINE') {
        state.totalScore += move.score;
        // Kartlarƒ± elden sil
        const ids = move.cards.map(x=>x.id);
        state.hand = state.hand.filter(x=>!ids.includes(x.id));
        
        // Yeni kart √ßekme
        const needed = Math.min(3, state.deckRemaining.length);
        if(needed > 0) {
            renderPicker(needed, (newCards)=>{
                state.hand.push(...newCards);
                state.deckRemaining = state.deckRemaining.filter(x=>!newCards.includes(x));
                updateUI(analyzeMove());
            });
        } else {
            endGame();
        }
    } else {
        // Discard
        const rm = move.cards[0];
        state.hand = state.hand.filter(x=>x.id !== rm.id);
        
        if(state.deckRemaining.length > 0) {
            renderPicker(1, (newCards)=>{
                state.hand.push(...newCards);
                state.deckRemaining = state.deckRemaining.filter(x=>!newCards.includes(x));
                updateUI(analyzeMove());
            });
        } else {
            endGame();
        }
    }
}

function endGame() {
    document.getElementById('resultModal').classList.add('active');
    document.getElementById('finalScore').innerText = state.totalScore;
    
    let txt = "BRONZ SANDIK üì¶";
    let style = "text-orange-400 border-orange-500";
    
    if(state.totalScore >= 400) {
        txt = "ALTIN SANDIK ‚ú®";
        style = "text-yellow-400 border-yellow-500";
    }
    else if(state.totalScore >= 300) {
        txt = "G√úM√ú≈û SANDIK ‚õìÔ∏è";
        style = "text-slate-300 border-slate-400";
    }
    
    const rewardEl = document.getElementById('rewardText');
    rewardEl.innerText = txt;
    rewardEl.className = `text-xl font-bold mb-8 py-2 px-6 rounded-lg bg-white/10 inline-block border ${style}`;
}
</script>
</body>
</html>